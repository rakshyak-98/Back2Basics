### Create table
```mysql
CREATE TABLE table_name (
	column1 datatype constraints,
	column2 datatype constraints,
)
```

```mysql
	CREATE TABLE users(
	id INT AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(100) NOT NULL,
	role VARCHAR(50) DEFAULT 'guest'
)
```

## Query table
```mysql
SELECT 
	table_schema,
	table_name,
	table_rows
FROM information_schema.tables
WHERE table_schema = 'your_database_name'
	AND table_rows > 1000;
```

## Create JSON type column

```sql
create table table_name(
	content JSON
)
```

```sql
insert into table_name (content) values ('{"name": "test user"}');
update table_name set content = '{"name": "james"}' where id = 1;
```

## update field
```mysql
update <tablename> Set <columnname> = <value> <condition>;
update employee Set name = "ram" where emp_id = 1000;
```
### update nested object value
```sql
UPDATE table_name
SET content = JSON_SET(
	content,
	'$.content.images.image2.url', 'http://example.com/1.png',
	'$.content.images.image2.url', 'http://example.com/1.png'
)
WHERE id = 1;
```

```mysql
UPDATE your_table
SET json_column = JSON_REMOVE(json_column, '$.yourKey')
WHERE your_condition;
```

### update array field value
```sql
UPDATE section
SET content = JSON_SET(
  content,
  '$.content.offers[0].title',
  'Updated Offer Title'
)
WHERE id = 1;

UPDATE section
SET content = JSON_SET(
  content,
  '$.content.offers[2].image.url',
  'https://example.com/new-image.jpg'
)
WHERE id = 1;

```

> [!INFO]
> replace the entire array
```sql
UPDATE section
SET content = JSON_SET(
  content,
  '$.content.offers',
  JSON_ARRAY(
    JSON_OBJECT(
      'title', 'New Offer Title',
      'image', JSON_OBJECT(
        'alt', 'New Alt',
        'url', 'https://example.com/new-offer.jpg',
        'width', 800,
        'height', 400
      ),
      'descriptionLines', JSON_ARRAY('Line 1', 'Line 2')
    )
  )
)
WHERE id = 1;
```

### Insert object into an array of Object for JSON type column

```mysql
update 
  sub_section 
set 
  content = JSON_ARRAY_APPEND(
    content, 
    '$', 
    JSON_OBJECT(
      'image', 
      JSON_OBJECT(
        'alt', 'KSUP room', 'url', 'https://quickimagetools.com/uploads/image_6855171736d464.12303213.png', 
        'width', 500, 'height', 400
      ), 
      'title', 
      'KSUP (KING superior)', 
      'desc
      'A warm and elegant room with modern amenities...'
    )
  ) 
where 
  id = 11;
```

### Table insert

> [!WARNING]
> Loses indexes, constraints - recreate manually if needed.
```mysql
-- Copy structure + insert data
INSERT INTO target_db.table_name SELECT * FROM source_db.table_name;
```

## Add columns to an existing table
```mysql
ALTER TABLE users
ADD (
	age INT
	is_active BOOLEAN DEFAULT TRUE,
	last_login TIMESTAMP
)
```

```mysql
ALTER TABLE table_name RENAME COLUMN old_name TO new_name;
ALTER TABLE table_name CHANGE COLUMN old_name TO new_name data_type;

```
### re-arrange columns
```mysql
ALTER TABLE table_name MODIFY column_name data_type AFTER other_column;
ALTER TABLE table_name MODIFY column_name data_tyep FIRST;
```

## Constraint
```mysql
ALTER TABLE hkAppNotification
ADD CONSTRAINT unique_floor_shift_department
UNIQUE (floorNumber, shiftName, department);
```
> [!NOTE]
> If **any of the 3 columns can be NULL**, then uniqueness is not guaranteed across rows with NULLs (as per SQL standard: `NULL != NULL`).

## Auto Update field value when update query run
```mysql
CREATE TABLE my_table (
	id INT PRIMARY KEY,
	updated_at TIMESTAMP DEFUALT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;
)
```

- remove the constraint from existing table 
```mysql
ALTER TABLE your_table
MODIFY COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
```
- `DEFAULT_GENERATED` -> is a metadata flag shown in `INFORMATION_SCHEMA.COLUMNS` to indicate that a column's default value was automatically generated by the system.

```mysql
SELECT COLUMN_NAME, COLUMN_DEFAULT, EXTRA, GENERATION_EXPRESSION, IS_GENERATED, COLUMN_DEFAULT_GENERATED
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'users';
```

### Data insert in table from other table
```mysql
INSERT INTO hkAppNotification (jobType, floorNumber, department, shiftName, level1Mobile, level2Mobile, level3Mobile, hodMobile)
SELECT jobType, floorNumber, department, shiftName, level1Mobile, level2Mobile, level3Mobile, hodMobile
FROM hkAppNotification
WHERE department = 15;
```

### How to define constraints
```mysql
CREATE TABLE orders (
	order_id INT PRIMARY KEY,
	custoemr_id INT
	FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
)

```

## Set foreign key constraints
```mysql
ALTER TABLE table_naem ADD CONSTRAINT FOREIGN KEY 
```

### Altering an existing table
```mysql
ALTER TABLE orders
ADD CONSTRAINT fk_customer
FOREIGN KEY (customer_id) REFERENCES customers(customer_id)

```

```mysql
ALTER TABLE table_name DROP COLUMN column_name;
```